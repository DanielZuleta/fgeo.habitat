---
title: "GetKrigedSoil()"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    theme: united
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(krig)
library(dplyr)
library(ggplot2)

options(dplyr.print_min = 6, dplyr.print_max = 6)

toy_data <- krig::soil_random
```

Inputs {.sidebar}
=======================================================================

```{r}
fluidRow(
  # column(5, actionButton("goButton", "Go!")), 
  column(
    5, textInput("var_id", "var", value = "M3Al")
  )
)
fluidRow(
  column(5, numericInput("gridSize_id", "gridSize", value = 20)),
  column(5, selectInput(
      "useKsLine_id", "useKsLine", choices = c(TRUE, FALSE), selected = TRUE
    )
  )
)
fluidRow(
  column(5, numericInput("xSize_id", "xSize", value = 1000)),
  column(5, numericInput("ySize_id", "ySize", value =  500))
)

hr()
helpText("breaks")
fluidRow(
  column(5, numericInput("first_id", "First", value = 2)),
  column(5, numericInput("last_id", "Last", value = 320))
)
numericInput("n_id", "n", value = 30)

hr()
hr()
numericInput("head_id", "head(x, n = ???)", value = 6)
```

Overview
=======================================================================

Column {data-width=40}
-----------------------------------------------------------------------

### Data

```{r}
renderPrint(print(as_tibble(toy_data), n = input$head_id))
```

### Plot

```{r}
renderPlot({
  result <- GetKrigedSoil(
    toy_data, 
    var = input$var_id,
    xSize = input$xSize_id,
    ySize = input$ySize_id,
    useKsLine = input$useKsLine_id,
    krigeParams = NULL,
    breaks = ExpList(
      input$first_id, 
      input$last_id, 
      input$n_id
    )
  )
  ggplot(result$df, aes(x, y, fill = z)) + 
    geom_tile() +
    coord_equal() +
    theme(legend.position = "top")
})
```

Column {data-width=60}
-----------------------------------------------------------------------

### Result {data-height=97}

```{r}
renderPrint({
  input$goButton
  result <- GetKrigedSoil(
    toy_data, 
    var = input$var_id,
    xSize = input$xSize_id,
    ySize = input$ySize_id,
    useKsLine = input$useKsLine_id,
    krigeParams = NULL,
    breaks = ExpList(
      input$first_id, 
      input$last_id, 
      input$n_id
    )
  )
  lapply(result, head, input$head_id)
})
```
