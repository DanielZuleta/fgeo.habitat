---
title: "Interpretation of `tt_test()` results"
author: "Daniel Zuleta"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```

```{r, error=TRUE}
# Implementation ----------------------------------------------------------

# Create a data frame to interprete the output of `tt_test()`.
tt_interpretation <- function(ttOutput) {
  habs <- dim(ttOutput)[2] / 6 # number of habitats
  tt_interp <- data.frame() # interpretation output
  tt_interp_names <- NULL
  # j is the species loop
  # i is the habitat loop
  
  for (j in 1:dim(ttOutput)[1]) {
    #
    for (i in 1:habs) {
      tt_interp[j, i] <- ifelse(
        ttOutput[j, i * 5] == 1 & (1 - (ttOutput[j, i * 6])) < 0.05,
        "aggregated",
        ifelse(
          ttOutput[j, i * 5] == 1 &
            (1 - (ttOutput[j, i * 6])) >= 0.05,
          "agg_nonsignificant",
          ifelse(
            ttOutput[j, i * 5] == -1 & (ttOutput[j, i * 6]) < 0.05,
            "repelled",
            ifelse(
              ttOutput[j, i * 5] == -1 &
                (ttOutput[j, i * 6]) >= 0.05,
              "rep_nonsignificant",
              "neutral"
            )
          )
        )
      )
    }
  }
  
  for (h in 1:habs) {
    tt_interp_names[h] <- paste("Habitat_", h, sep = "")
  }
  
  tt_interp <- data.frame(cbind(Species = row.names(ttOutput), tt_interp))
  names(tt_interp) <- c("Species", tt_interp_names)
  return(tt_interp)
}


# Creating the input of tt_interpretation ---------------------------------

# Example from ?tt_test()

library(fgeo.habitat)
library(dplyr)

# For easier data wranging
habitat <- luquillo_habitat
census <- luquillo_top3_sp

# Pick alive trees, of 10 mm or more
pick <- filter(census, status == "A", dbh >= 10)
# Pick sufficiently abundant trees
pick <- add_count(pick, sp)
pick <- filter(pick, n > 50)

species <- unique(pick$sp)

# Test any number of species (output a list of matrices)
tt_lst <- tt_test(census, species, habitat)

tt_lst

# Using tt_interpretation -------------------------------------------------

tt_interpretation(tt_lst)
```

